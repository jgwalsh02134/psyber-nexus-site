:root{
  /* Brand (Psyber Nexus) */
  --brand: #1f6feb;
  --accent: #008080;
  --brand-ink: #0F172A;

  /* Light neutrals */
  --bg: #F8FAFC;
  --surface: #FFFFFF;
  --ink: #111827;
  --muted: #475569;
  --line: #E2E8F0;

  /* Effects */
  --focus: #2ECAD0;
  --radius: 12px;
  --shadow-1: 0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.04);
  --shadow-2: 0 10px 25px rgba(0,0,0,.08);

  /* Type scale */
  --fs-base: clamp(0.98rem, 0.92rem + 0.35vw, 1.06rem);
  --fs-msg:  clamp(1.00rem, 0.96rem + 0.30vw, 1.06rem);
  --lh-body: 1.55;
  --lh-msg:  1.50;

  /* Chat rail sizes */
  --rail-max: 62rem;
  --bubble-max: 80ch;

  /* Viewport helpers */
  --header-h: 56px;
  --vvh: 100dvh;

  /* legacy spacing and width tokens (kept) */
  --space-1:4px; --space-2:8px; --space-3:12px; --space-4:16px; --space-5:24px; --space-6:32px;
  --maxw:1100px;

  /* fonts */
  --font-sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --step--1: clamp(0.78rem, 0.74rem + 0.2vw, 0.9rem);
  --step-0: clamp(0.9rem, 0.85rem + 0.35vw, 1rem);
  --step-1: clamp(1.05rem, 0.95rem + 0.6vw, 1.25rem);
  --step-2: clamp(1.25rem, 1.1rem + 0.9vw, 1.6rem);
  --step-3: clamp(1.5rem, 1.25rem + 1.4vw, 2rem);
  --step-4: clamp(1.85rem, 1.5rem + 2.2vw, 2.6rem);
}

/* Optional dark class (fallback) */
:root.dark{
  --bg:#0B1220; --surface:#0F172A; --ink:#E5E7EB; --muted:#94A3B8; --line:#243143;
  --brand:#6CA8FF; --accent:#2ECAD0; --focus:#2ECAD0;
}

/* Psyber Nexus brand tokens */
:root {
  /* brand from guide */
  --pn-rim:#003B4C; --pn-teal:#008080; --pn-teal-aaa:#006363; --pn-accent:#2ECAD0;
  /* neutrals */
  --pn-ink:#0F172A; --pn-muted:#475569; --pn-bg:#F8FAFC; --pn-surface:#FFFFFF;
  /* effects */
  --pn-focus:var(--focus); --pn-radius:8px;
  --pn-shadow-1:0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.04);
  --pn-globe-gradient:linear-gradient(180deg, var(--pn-accent) 0%, var(--pn-teal) 100%);
}
:root.dark, :root[data-theme="dark"] { --pn-ink:#E5E7EB; --pn-muted:#94A3B8; --pn-bg:#0B1220; --pn-surface:#0F172A; }

/* font families (token vars only; see head links) */
:root{
  --pn-font-sans:"Inter", ui-sans-serif, system-ui, -apple-system, "Helvetica Neue", Arial, sans-serif;
  --pn-font-mono:"Source Code Pro", ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  --pn-font-serif:"Source Serif 4", ui-serif, Georgia, serif; /* optional */
}

/* type scale */
:root{
  --step-0:1rem; --step-1:1.25rem; --step-2:1.563rem; --step-3:1.953rem; --step-4:2.441rem;
  --lh-tight:1.15; --lh-body:1.65;
}
html{ font-family:var(--pn-font-sans); font-optical-sizing:auto; }
code, pre{ font-family:var(--pn-font-mono); }

/* semantic helpers */
.h1{ font:700 var(--step-4)/var(--lh-tight) var(--pn-font-sans); letter-spacing:-0.01em; }
.h2{ font:700 var(--step-3)/var(--lh-tight) var(--pn-font-sans); letter-spacing:-0.01em; }
.h3{ font:600 var(--step-2)/1.2 var(--pn-font-sans); }
.body{ font:400 var(--step-0)/var(--lh-body) var(--pn-font-sans); }
.small{ font:400 .889rem/1.6 var(--pn-font-sans); }
.code{ font:400 .9375rem/1.6 var(--pn-font-mono); font-variant-numeric:tabular-nums lining-nums; }

/* UI helpers */
.pn-btn{ color:#fff; background:var(--pn-rim); border-radius:var(--pn-radius); box-shadow:var(--pn-shadow-1); padding:.55rem 1rem; font-weight:600; border:1px solid color-mix(in oklab, var(--pn-rim), black 12%); }
.pn-btn:hover{ background:color-mix(in oklab, var(--pn-rim), black 10%); }
.pn-btn-secondary{ color:#fff; background:var(--pn-teal); border-radius:var(--pn-radius); padding:.55rem 1rem; font-weight:600; border:1px solid color-mix(in oklab, var(--pn-teal), black 12%); }
.pn-card{ background:var(--pn-surface); border:1px solid rgba(15,23,42,.08); border-radius:var(--pn-radius); box-shadow:var(--pn-shadow-1); }
.pn-link{ color:var(--pn-teal); text-underline-offset:3px; }
.pn-link:hover{ text-decoration:underline; }

/* accessibility & focus */
:focus-visible{ outline:2px solid var(--focus); outline-offset:3px; }

/* map existing brand tokens so older selectors still work, without overriding new vars */
:root{
  --pn-ink: var(--ink);
  --pn-muted: var(--muted);
  --pn-bg: var(--bg);
  --pn-surface: var(--surface);
  --pn-focus: var(--focus);
  --radius: var(--radius);
  /* legacy font vars -> brand */
  --font-sans: var(--pn-font-sans);
  --font-mono: var(--pn-font-mono);
  /* layout */
  --header-h: 56px;
  --vvh: 100dvh;
}

* { box-sizing: border-box; }
html, body { height: 100%; }
html { background: var(--bg); color-scheme: light; font-size: var(--fs-base); line-height: var(--lh-body); }
body {
  margin: 0;
  color: var(--ink);
  background: var(--bg);
  font-family: var(--font-sans);
  line-height: 1.6;
  font-size: var(--step-0);
}

a { color: var(--brand); text-decoration: none; }
a:hover, a:focus-visible { text-decoration: underline; }

/* Scrollbar (light) */
::-webkit-scrollbar{ width:10px; height:10px }
::-webkit-scrollbar-track{ background:#EFF3F9 }
::-webkit-scrollbar-thumb{ background:#C7D2E4; border-radius:10px }
::-webkit-scrollbar-thumb:hover{ background:#B5C2DA }

img { max-width: 100%; height: auto; }

.skip {
  position: absolute; left: -999px; top: auto;
  width: 1px; height: 1px; overflow: hidden;
}
.skip:focus { position: static; width: auto; height: auto; padding: var(--space-2); background: var(--surface); border-radius: var(--radius); }

.wrap { max-width: var(--maxw); margin-inline: auto; padding-inline: var(--space-4); }
/* Full-width shell on chat page overrides the generic .wrap max-width */
.wrap#chat-shell, #chat-shell.wrap{ max-width:none; width:100%; padding-inline:clamp(12px, 2vw, 24px) }
.stack > * + * { margin-top: var(--space-4); }
.row { display: flex; gap: var(--space-3); flex-wrap: wrap; align-items: center; }
.grid { display: grid; gap: var(--space-4); grid-template-columns: 1fr; }
@media (min-width: 700px) { .grid { grid-template-columns: repeat(2, 1fr); } }

.header {
  position: sticky; top: 0; z-index: 20;
  background: rgba(255,255,255,.78);
  backdrop-filter: blur(8px);
  border-bottom: 1px solid var(--line);
  color: var(--brand-ink);
}
.header .wrap { display: flex; align-items: center; justify-content: space-between; gap: var(--space-3); }
.brand .logo { color: var(--ink); font-weight: 700; letter-spacing: 0.3px; }
.nav { position: fixed; inset: 0 0 auto 0; top: 56px; background: var(--surface); transform: translateY(-100%); transition: transform .2s ease; border-bottom: 1px solid var(--line); }
.nav-list { list-style: none; margin: 0; padding: var(--space-4); display: grid; gap: var(--space-3); }
.nav a { color: var(--ink); font-weight: 600; }
.nav-toggle { min-width: 44px; min-height: 44px; }
body[data-nav-open="true"] .nav { transform: translateY(0); }
@media (min-width: 900px) {
  .nav { position: static; transform: none; background: transparent; border: 0; top: auto; }
  .nav-list { display: flex; gap: var(--space-4); padding: 0; }
  .nav-toggle { display: none; }
}

/* Nav enhancements */
.nav-list a { display: inline-block; padding: 10px 8px; border-radius: 8px; min-height: 44px; }
.nav a[aria-current="page"] { text-decoration: underline; text-underline-offset: 4px; }
/* Overlay header + mobile nav */
.site-header{position:sticky;top:0;z-index:60;backdrop-filter:blur(8px);border-bottom:1px solid var(--line);background:rgba(255,255,255,.78);color:var(--brand-ink)}
.navbar{display:flex;align-items:center;gap:16px;min-height:var(--header-h)}
.brand{font-weight:700}
.hamburger{display:inline-flex;align-items:center;justify-content:center;width:40px;height:40px;border:1px solid var(--line);border-radius:10px;background:transparent}
.hamburger span{display:block;width:18px;height:2px;background:var(--ink);margin:3px 0}
.nav-inline{display:none}
@media (min-width:900px){ .hamburger{display:none} .nav-inline{display:flex;gap:16px;margin-left:auto} .nav-inline a{padding:0} }
.nav-overlay{position:fixed;inset:0;z-index:55;background:rgba(0,0,0,.55)}
.nav-panel{position:absolute;left:0;right:0;top:calc(var(--header-h) + var(--safe-top));background:rgba(15,23,42,.96);border-top:1px solid var(--line);max-height:calc(100dvh - var(--header-h) - var(--safe-top));overflow:auto;-webkit-overflow-scrolling:touch;display:flex;flex-direction:column;gap:4px;padding:8px 12px 20px}
.nav-panel a{display:block;padding:14px 8px;border-bottom:1px solid var(--line)}
html.nav-open .nav-overlay{display:block}
[hidden]{display:none !important}
.nav-panel a[aria-current="page"], .nav a[aria-current="page"]{text-decoration:underline}
/* Desktop inline nav reinforcement and mobile hide */
@media (min-width:900px){
  #site-nav{display:flex !important}
  #site-nav[hidden]{display:flex !important}
}
@media (max-width:899.98px){
  #site-nav{display:none}
}

.hero { padding-block: clamp(48px, 10vw, 96px); background: radial-gradient(1200px 600px at 50% -20%, rgba(31,111,235,0.15), transparent), var(--bg); border-bottom: 1px solid var(--line); }
.kicker { color: var(--muted); font-size: var(--step-0); text-transform: uppercase; letter-spacing: 0.08em; }
h1 { font-size: var(--step-4); line-height: 1.1; margin: 0 0 var(--space-4); }
h2 { font-size: var(--step-3); line-height: 1.2; margin: var(--space-6) 0 var(--space-3); }
h3 { font-size: var(--step-2); margin: var(--space-4) 0 var(--space-2); }
.lede { font-size: var(--step-1); color: var(--ink); max-width: 65ch; }

.btn { appearance: none; background: var(--brand); color:#fff; border:1px solid color-mix(in oklab, var(--brand), #000 18%); border-radius: var(--radius); padding: 10px 16px; font-weight:600; }
.btn:hover, .btn:focus-visible { filter: brightness(1.05); }
.btn.ghost { background:#fff; color: var(--brand-ink); border:1px solid var(--line); }
.btn[disabled] { opacity: .6; cursor: not-allowed; }

.card { background: var(--surface); border:1px solid var(--line); border-radius: var(--radius); padding: var(--space-5); box-shadow: var(--shadow-1) }

/* readability on dark for cards/panels */
.chat-panel, .feature-card { background: transparent; border:1px solid var(--line); }

.features .grid { display: grid; gap: var(--space-4); grid-template-columns: 1fr; }
@media (min-width: 700px) { .features .grid { grid-template-columns: repeat(2, 1fr); } }
.cta-more { margin-top: var(--space-5); }

.console .panel {
  background: #0b1220;
  border: 1px solid var(--line);
  border-radius: var(--radius);
  padding: var(--space-3);
  margin-top: var(--space-4);
}
.output {
  font-family: var(--font-mono);
  font-size: var(--step--1);
  white-space: pre-wrap;
  max-height: 45vh;
  overflow: auto;
}
.spinner {
  width: 18px; height: 18px; border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.25);
  border-top-color: var(--accent);
  display: inline-block;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.footer { border-top: 1px solid var(--line); margin-top: var(--space-6); padding: var(--space-5) 0; }
.footer nav { display: flex; gap: var(--space-4); flex-wrap: wrap; }

.field label { display: block; margin-bottom: var(--space-1); }
input, textarea {
  width: 100%; color: var(--ink); background: var(--surface);
  border: 1px solid var(--line); border-radius: var(--radius); padding: var(--space-3);
}
input:focus-visible, textarea:focus-visible, .btn:focus-visible, a:focus-visible {
  outline: 2px solid var(--pn-focus);
  outline-offset: 2px;
}

.visually-hidden {
  position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden;
  clip: rect(0 0 0 0); white-space: nowrap; border: 0;
}
.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); white-space:nowrap; border:0; }
.sr-only-focusable:active, .sr-only-focusable:focus { position: static; width:auto; height:auto; clip:auto; white-space:normal; padding: var(--space-2); background: var(--surface); border-radius: var(--radius); border:1px solid var(--line); z-index:1000; }
.sr-only.sr-only-focusable:focus{ left:12px; top:12px; width:auto; height:auto; padding:.4rem .6rem; border:1px solid var(--line); border-radius:8px; background:var(--surface); z-index:1000; position:absolute; clip:auto; white-space:normal; }
.noscript { padding: var(--space-2); margin: var(--space-3); background: var(--surface); border: 1px solid var(--line); border-radius: var(--radius); }
.muted { color: var(--muted); }

#toast {
  position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
  max-width: 90vw; background: var(--surface); color: var(--ink);
  border: 1px solid var(--line); border-radius: var(--radius);
  padding: var(--space-3) var(--space-4); box-shadow: 0 8px 24px rgba(0,0,0,0.35);
  display: none;
}
#toast.show { display: block; }

@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
}

/* Chat page styles */
.chat-shell{display:grid;gap:16px}
@media (min-width:900px){.chat-shell{grid-template-columns:2fr 1fr}}
.chat-panel{border:1px solid var(--line);background:rgba(255,255,255,.02);border-radius:var(--radius,12px);padding:12px;min-height:calc(var(--vvh) - var(--header-h));display:flex;flex-direction:column}
.chat-header{position:sticky;top:0;z-index:5;display:flex;align-items:center;gap:8px;padding:6px 0;background:rgba(255,255,255,.78);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);color:var(--brand-ink)}
.chat-header .grow{flex:1}
.chat-log{list-style:none;margin:0;padding:8px 0 12px;display:flex;flex-direction:column;gap:10px;flex:1 1 auto;overflow:auto;overscroll-behavior:contain;-webkit-overflow-scrolling:touch;scroll-behavior:smooth;scroll-padding-bottom:110px}
/* centered rail */
#chat-rail{min-width:0;min-height:0;display:flex;flex-direction:column;overflow:hidden;width:100%;max-width:min(var(--rail-max),100%);margin-inline:auto;padding-inline:clamp(12px, 2vw, 24px);background:transparent}
/* Page-level viewport lock just for the chat page */
#chat-shell{display:grid;grid-template-columns:minmax(0,1fr) clamp(18rem, 22vw, 22rem);gap:var(--gap-md);height:calc(var(--vvh) - var(--header-h));max-height:calc(var(--vvh) - var(--header-h));overflow:hidden}
@media (max-width:1200px){#chat-shell{grid-template-columns:minmax(0,1fr) 300px}}
@media (max-width:1024px){#chat-shell{grid-template-columns:1fr}#chat-help{display:none}.tips-toggle{position:fixed;right:16px;bottom:110px;z-index:7;display:inline-flex}}

/* Ensure the panel itself doesn't cause page overflow; only its child log can scroll */
#chat-panel{display:flex;flex-direction:column;min-height:0;min-width:0;overflow:hidden;background:transparent}

/* Tips column scrolls independently */
#chat-help{min-height:0;overflow:auto;background:var(--surface);border-left:1px solid var(--line);box-shadow:var(--shadow-1)}
.msg{display:grid;gap:6px;padding:10px;border:1px solid var(--line);border-radius:12px;background:var(--surface);box-shadow:var(--shadow-1);color:var(--ink);max-width:80ch}
.msg{gap:8px;padding:clamp(12px,10px + 0.5vw,16px);border-radius:14px;font-size:var(--fs-msg);line-height:var(--lh-msg);width:min(100%,var(--bubble-max))}
.msg.assistant{margin-inline:0 auto}
.msg.user{margin-inline:auto 0;background:#EAF2FF;border-color:#C7D7F8}
.msg .meta{font-size:.85em;color:var(--muted)}
.msg .content{white-space:normal;word-break:break-word}
.msg .text{white-space:normal;word-break:break-word}
.msg pre{background:rgba(255,255,255,.04);border:1px solid var(--line);padding:12px;border-radius:12px;overflow:auto}
.msg code,.msg pre code{font:400 .94rem/1.45 var(--pn-font-mono,ui-monospace,SFMono-Regular,Menlo,Consolas,monospace)}
/* Markdown elements inside message bubbles */
.msg :where(h1,h2,h3){ font-weight:700; line-height:1.28; margin-block:.55rem .3rem; }
.msg h1{ font-size: clamp(1.22rem, 1.05rem + 1.0vw, 1.55rem); }
.msg h2{ font-size: clamp(1.14rem, 1.02rem + 0.8vw, 1.35rem); }
.msg h3{ font-size: clamp(1.07rem, 1.0rem + 0.6vw, 1.22rem); }
.msg p{ margin-block:.45rem; line-height: var(--lh-msg); }
.msg ul{ list-style: disc; padding-left: 1.1rem; margin-block:.45rem; }
.msg ol{ list-style: decimal; padding-left: 1.1rem; margin-block:.45rem; }
.msg li{ margin-block:.20rem; }
.msg blockquote{ border-left:3px solid color-mix(in oklab, var(--brand,#1f6feb), white 22%); padding-left:.8rem; margin:.6rem 0; color: var(--muted); }
.msg pre{ background:#F5F7FB; color:#0F172A; border:1px solid #E2E8F0; border-radius:12px; padding:10px 12px; line-height:1.45; margin-block:.5rem; overflow:auto; box-shadow: inset 0 1px 0 rgba(255,255,255,.6) }
.msg code{ background:#EEF2F7; color:#0F172A; padding:.05rem .35rem; border-radius:6px; border:1px solid #E2E8F0 }
.icon-btn{display:inline-grid;place-items:center;width:clamp(40px,36px + 1vw,44px);height:clamp(40px,36px + 1vw,44px);border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--brand-ink);opacity:.95}
.icon-btn:hover,.icon-btn:focus-visible{opacity:1;outline:2px solid var(--brand);outline-offset:2px}
.icon-img{width:18px;height:18px;display:block;pointer-events:none}
.msg-actions-row{display:flex;gap:6px;opacity:0;transition:opacity .15s}
.msg:hover .msg-actions-row,.msg:focus-within .msg-actions-row{opacity:1}
@media (hover:none){.msg-actions-row{opacity:1}}
.chat-form{margin-top:auto;display:grid;gap:8px;flex:0 0 auto;position:sticky;bottom:0;padding-bottom:max(12px, env(safe-area-inset-bottom));background:linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,.88) 38%, rgba(255,255,255,.94) 60%);backdrop-filter:blur(4px);border-top:1px solid var(--line)}
#chat-input{resize:none;overflow:auto;max-height:10lh;min-height:2.4rem;padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;color:var(--ink)}
.chat-actions{display:flex;gap:8px;justify-content:flex-end}
.btn--spin{position:relative;color:transparent}
.btn--spin::after{content:"";position:absolute;inset:0;margin:auto;width:1rem;height:1rem;border:.18rem solid rgba(255,255,255,.3);border-top-color:currentColor;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.to-bottom{position:sticky;bottom:115px;margin-left:auto;z-index:5;background:#fff;color:var(--brand-ink);border:1px solid var(--line);border-radius:999px;padding:.35rem .7rem}
.chat-alert{min-height:1.2rem;color:var(--muted);font-size:.9rem}
.chip-list{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 0;padding:0;list-style:none}
.chip{border:1px solid var(--line);border-radius:999px;padding:.35rem .7rem;background:transparent;color:var(--ink)}
/* chat header controls */
.mode-pill{font-size:.8rem;padding:.3rem .5rem;border:1px solid var(--line);border-radius:10px;background:transparent;color:inherit;margin-right:6px}
.model-pill{font-size:.75rem;padding:.25rem .5rem;border:1px solid var(--line);border-radius:999px;background:transparent;color:var(--muted)}
/* tips drawer */
.tips-drawer{position:fixed;inset:0;z-index:20;background:rgba(0,0,0,.55)}
.tips-sheet{position:absolute;left:0;right:0;bottom:0;max-height:70vh;overflow:auto;background:rgba(15,23,42,.98);border-top:1px solid var(--line);border-radius:18px 18px 0 0}
.tips-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--line)}
.tips-body{padding:12px}
/* global focus ring */
:focus-visible{outline:2px solid var(--focus);outline-offset:3px}

/* Sticky footer layout */
body.page{min-height:100dvh;display:flex;flex-direction:column}
main{flex:1 0 auto}
footer{margin-top:auto}

/* Ensure light backgrounds on chat containers */
body, #chat-panel, #chat-rail, .chat-log{ background: transparent }
